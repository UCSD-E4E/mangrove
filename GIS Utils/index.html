<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>GIS Utils - E4E Mangrove Monitoring</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-dune-light.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">E4E Mangrove Monitoring</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../About/" class="nav-link">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">ML <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../CNN/" class="dropdown-item">CNN</a>
</li>
                                    
<li>
    <a href="../UNet/" class="dropdown-item">UNet</a>
</li>
                                    
<li>
    <a href="../Semi-Supervised/" class="dropdown-item">Semi-Supervised</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tools <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Labeling%20Tool/" class="dropdown-item">Labeling Tool</a>
</li>
                                    
<li>
    <a href="../Image%20Classification%20Tool/" class="dropdown-item">Image Classification Tool</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">GIS Utils</a>
</li>
                                    
<li>
    <a href="../Azure%20Slackbot/" class="dropdown-item">Azure Slack Bot</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Other <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Misc/" class="dropdown-item">Misc</a>
</li>
                                    
<li>
    <a href="../Papers/" class="dropdown-item">Papers</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../Image%20Classification%20Tool/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Azure%20Slackbot/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#requirements" class="nav-link">Requirements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#general-tools" class="nav-link">General Tools</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#load_image" class="nav-link">load_image()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#retiling-rasters" class="nav-link">Retiling Rasters</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#retile" class="nav-link">retile()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#polygonizing-rasters" class="nav-link">Polygonizing Rasters</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#polygonize" class="nav-link">polygonize()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#downsampling-rasters" class="nav-link">Downsampling Rasters</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#downsample_raster" class="nav-link">downsample_raster()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#demo-notebook" class="nav-link">Demo Notebook</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="introduction">Introduction</h1>
<p>GIS Utils is a python package aimed to improve on many of the inabilities of GDAL Python scripts to be faster, properly multithreaded, and much easier to use with a ML workflow than GDAL on its own. GIS Utils provides a few high level abstractions of GIS workflows aimed to be used for ML workflows, such as tilizing of images, raster to image conversions, and a few other tools specific to our workflow in particular. </p>
<p></br></p>
<h1 id="requirements">Requirements</h1>
<p>In order to use GIS Utils, the below python libraries must be installed:</p>
<p><code>rasterio</code>
<code>fiona</code>
<code>geopandas</code>
<code>gdal</code></p>
<p>We reccomending using Google Colab or an Anaconda Environment as this package also requires many of the packages preincluded in those environments:</p>
<p><code>tqdm</code>
<code>numpy</code>
<code>pandas</code></p>
<p>For your convenience, we have a series of <code>pip</code> and <code>apt-get</code> commands that you can use below in order to download all of the prerequisite packages for GIS Utils. </p>
<pre><code class="console">!apt-get update
!apt-get install libgdal-dev -y
!apt-get install python-gdal -y
!apt-get install python-numpy python-scipy -y
!pip install rasterio
!pip install fiona
!pip install geopandas
</code></pre>

<p><strong>Once the previous libraries have been installed, you can simply use pip to install GIS Utils to your python environment.</strong> </p>
<pre><code class="console">pip install -i https://test.pypi.org/simple/ gis-utils-pkg-dillhicks==0.0.2
</code></pre>

<p></br></p>
<h1 id="general-tools">General Tools</h1>
<h2 id="load_image"><code>load_image()</code></h2>
<p><code>load_image</code> is intended as a quick wrapper to of some rasterio functions to directly get the generator of the image and some of the metainformation of the original image. This function should typically be used in order to </p>
<p><strong>Inputs:</strong></p>
<p><code>file</code> - Filelocation of input raster</p>
<p><strong>Outputs:</strong></p>
<p><code>img</code> - Image generator from the specified input raster</p>
<p><code>meta</code> - Meta information from the specified input raster</p>
<p></br></p>
<h3 id="get_area"><code>get_area()</code></h3>
<p><code>get_area</code> simply gets the area from an input shapefile with the specified CRS from a geopandas dataframe of an input shapefile. </p>
<p><strong>Inputs:</strong></p>
<p><code>gpd_df</code> - Filelocation of input raster</p>
<p><code>crs</code> - Projection for which to find the area - note the resulting area can differ greatly between different types of projections, so try to use the same projection in your further calculations. Defaults to EPSG 3857 (<code>'epsg:3857'</code>).</p>
<p><strong>Outputs:</strong></p>
<p>The area of the polygon(s) in m^2. In order to convert this to km^2, divide this number by 10**6.</p>
<p></br></p>
<h1 id="retiling-rasters">Retiling Rasters</h1>
<p><img alt="retile" src="../gis_utils/retile.PNG" /></p>
<h2 id="retile"><code>retile()</code></h2>
<p><code>Retile</code> is aimed to be a faster, easier to use version of <code>gdal_retile.py</code>, being able to be used in the form of a python function, and easily transferred to be used in an application or with argparse. It has the ability to output both a numpy array of the original raster, and the ability to save the resulting tiles. <code>Retile</code> is multithreaded, meaning it is much faster than it's older gdal sibling, which unfortunately only runs on 1 thread. </p>
<p>Just to give a comparison, this implementation is quicker than <code>gdal_retile.py</code>, especially when you don't save output files and have more threads to access!</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gdal_retile.py</code></td>
<td>13 sec</td>
</tr>
<tr>
<td><code>retile()</code> (files = True)</td>
<td>12.5 sec</td>
</tr>
<tr>
<td><code>retile()</code> (files = False)</td>
<td>8.25 sec</td>
</tr>
</tbody>
</table>
<p><strong>Inputs:</strong></p>
<p><code>img</code> - Image generator from the specified input raster - from <code>load_image</code></p>
<p><code>meta</code> - Meta information from the specified input raster - from <code>load_image</code></p>
<p><code>out_path</code> - Output path for image tiles, note that you need to create this folder - defaults to <code>'images/'</code></p>
<p><code>files</code> - Whether to output image tiles to the specified <code>out_path</code> - defaults to False</p>
<p><code>width</code> - Width of output tiles in pixels - defaults to 256</p>
<p><code>height</code> - Height of output tiles in pixels - defaults to 256</p>
<p><strong>Outputs:</strong></p>
<p><code>results</code> - List containing numpy array tiles </p>
<p><strong>Note:</strong> The tiles outputted have the standard rasterio shape with <code>(bands, rows, columns)</code>, meanwhile many image processing tools such as scikit-image and Pillow use an image shape of <code>(columns,bands,rows)</code>. You can use <code>reshape_as_raster(array)</code> and <code>reshape_as_image(array)</code> to convert to rasterio format and image processing format, respectively. </p>
<pre><code class="python">from rasterio.plot import reshape_as_raster, reshape_as_image
</code></pre>

<p><strong>Example Usage:</strong></p>
<pre><code class="python">file = &quot;lap_2018-07_site05_120m_RGB_cc.tif&quot; 
img, meta = load_image(file)
results = generate_tiles(img,meta,files=False)
tile = reshape_as_image(results[0])
</code></pre>

<p></br></p>
<h3 id="get_tiles"><code>get_tiles()</code></h3>
<p>Get tiles is a function to generate the bounds of the image tiles generated in <code>retile</code>.</p>
<p><strong>Inputs:</strong></p>
<p><code>ds</code> - Image generator from the specified input raster - from <code>load_image</code></p>
<p><code>width</code> - Width of output tiles in pixels - defaults to 256</p>
<p><code>height</code> - Height of output tiles in pixels - defaults to 256</p>
<p><strong>Outputs:</strong></p>
<p><code>out_window, out_transform</code> - A tuple of lists, with each list containing each tiles respective window and transform</p>
<p><strong>Example Usage:</strong></p>
<pre><code class="python">window, transform = get_tiles(img, width, height)
tile = img.read(window=window)
</code></pre>

<p></br></p>
<h1 id="polygonizing-rasters">Polygonizing Rasters</h1>
<p><img alt="polygonize" src="../gis_utils/polygonize.PNG" /></p>
<h2 id="polygonize"><code>polygonize()</code></h2>
<p>Polygonize is intended to be a much faster implementation of <code>gdal_polygonize.py</code>. I'm not going to bring out a chart like I did with <code>retile</code>, but expect 30x increases in processing time compared to  <code>gdal_polygonize.py</code> :). </p>
<p><strong>Inputs:</strong></p>
<p><code>img</code>: Image generator from the specified input raster - from <code>load_image</code>
<code>out_file</code>: Output filename of shapefile to write
<code>band</code>: Band in which to make polygons from - defaults to 4 (Alpha layer)</p>
<p><strong>Outputs:</strong> 
<code>geopandas_df</code>: Geopandas dataframe containing the geometries from the input raster band</p>
<p><strong>Example Usage:</strong></p>
<pre><code class="python">file = &quot;/content/downsampled_m_psc_2018-05_site09_120m_RGB.tif&quot;
img, meta = load_image(file)
df = polygonize(img,  out_file=&quot;/content/test.shp&quot;, band=4)
</code></pre>

<p></br></p>
<h3 id="fixing-polygonized-rasters">Fixing Polygonized Rasters:</h3>
<p>When generating polygons from the alpha layer, our scripts will generate polygons for all pixel values in the original raster (ex. will make polygons for 0 and 255 alpha values), so the functions below are aimed to fix these and only generate polygons for the specified class of polygons.</p>
<p></br></p>
<h4 id="fix_shp"><code>fix_shp()</code></h4>
<p>This is used for the above "fixing" of polygons created from <code>polygonize()</code> as explained above. </p>
<p><strong>Inputs:</strong></p>
<p><code>shp</code>: geopandas dataframe of the shapefile outputted from <code>polygonize()</code></p>
<p><code>filename</code>: of input shapefile from <code>polygonize()</code></p>
<p><strong>Outputs:</strong></p>
<p><code>shp</code>: geopandas dataframe of fixed polygons</p>
<p></br></p>
<h4 id="fix_gdalshp"><code>fix_gdalshp()</code></h4>
<p>Similarly, this is used for fixing the polygons when generated from <code>gdal_polygonize.py</code></p>
<p><strong>Inputs:</strong></p>
<p><code>shp</code>: geopandas dataframe of the shapefile outputted from <code>gdal_polygonize.py</code></p>
<p><code>filename</code>: of input shapefile from <code>gdal_polygonize.py</code></p>
<p><strong>Outputs:</strong>
<code>shp</code>: geopandas dataframe of fixed polygons</p>
<p></br></p>
<h1 id="downsampling-rasters">Downsampling Rasters</h1>
<p><img alt="downsample" src="../gis_utils/downsample.PNG" /></p>
<h2 id="downsample_raster"><code>downsample_raster()</code></h2>
<p>As the name intends, this is for downsampling rasters. This has been used previously in order to generate previews for all of our rasters in the drive that are geolocated and can easily be used for testing. </p>
<p><strong>Inputs:</strong></p>
<p><code>img</code> - Image generator from the specified input raster - from <code>load_image</code></p>
<p><code>downscale_factor</code> - How much to downsample (or upsample) your image. An appropriate input would be <code>1/25</code> , <code>1/5</code>, <code>10</code>, etc.</p>
<p><code>out_file</code> - Output filename of downsampled raster to write</p>
<p><strong>Outputs:</strong>
<code>resampled</code> - Output numpy array of the resampled raster</p>
<p><code>transform</code> - Transform of the resampled raster</p>
<h1 id="demo-notebook">Demo Notebook</h1>
<script src="https://gist.github.com/dillhicks/14b4f8d95651678326f4bc1f3e0795ce.js"></script>

<p></br>
</br>
</br></p>
<table>
<thead>
<tr>
<th>Author</th>
<th>Email</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dillon Hicks</td>
<td>sdhicks@ucsd.edu</td>
</tr>
</tbody>
</table></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
